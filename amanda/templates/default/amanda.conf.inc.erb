# Generated by Chef, do not edit
# See `man amanda.conf`

<%
amanda = node[:amanda]
amanda_dir = amanda[:dir]
runtapes = amanda[:runtapes]
-%>

dumpuser          "amandabackup"
mailto            "noc@cogini.com"

indexdir          "<%= amanda_dir[:index_dir] %>"
infofile          "<%= amanda_dir[:info_dir] %>"
logdir            "<%= amanda_dir[:log_dir] %>"

amrecover-changer "changer"
inparallel        <%= amanda[:inparallel] %>
netusage          <%= amanda[:netusage] %>

tapetype          "GigabyteTape"
runtapes          <%= runtapes %> tapes
tapecycle         <%= runtapes * 11 %> tapes


define tapetype GigabyteTape {
  length   10 gb
  filemark 4 kb
}


holdingdisk hd {
  directory "<%= amanda_dir[:holding_dir] %>"
}


define application-tool app_amgtar {
  plugin "amgtar"
  property append "IGNORE" ": File removed before we read it$"
  property append "IGNORE" ": file changed as we read it$"
  # XXX: Not sure how this happens
  property append "IGNORE" ": No such file or directory"
}


define dumptype encrypt-tar-local {
  auth    "local"
  program "APPLICATION"
  application "app_amgtar"
  # Add encryption later
}

define dumptype encrypt-tar-remote {
  auth     "ssh"
  ssh-keys "<%= amanda[:home] %>/.ssh/id_rsa"
  program "APPLICATION"
  application "app_amgtar"
  # Add encryption later
}
