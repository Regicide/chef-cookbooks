# Generated by Chef

<% amanda = node[:amanda]
amanda_dir = amanda[:dir]
tape = amanda[:tape] -%>

org "Daily"
mailto "noc@cogini.com"
infofile "<%= amanda_dir[:info_dir] %>"
logdir "<%= amanda_dir[:log_dir] %>"
indexdir "<%= amanda_dir[:index_dir] %>"
dumpuser "amandabackup"

tpchanger "chg-disk:<%= amanda_dir[:vtapes_dir] %>"
labelstr "Daily<% for i in 1..amanda[:tapecycle].to_s().length do -%>[0-9]<% end -%>"
autolabel "Daily<% for i in 1..amanda[:tapecycle].to_s().length do -%>%<% end -%>" EMPTY VOLUME_ERROR
tapecycle <%= amanda[:tapecycle] %>
dumpcycle <%= amanda[:dumpcycle] %> days
amrecover_changer "changer"

runtapes <%= amanda[:runtapes] %>

tapetype "GigabyteTape"
define tapetype GigabyteTape {
  length <%= tape[:length] %> gbytes
  filemark 4 kbytes
  part_size <%= tape[:part_size] %> mbytes
  part_cache_type <%= tape[:part_cache_type] %>
  part_cache_dir "<%= tape[:part_cache_dir] %>"
  part_cache_max_size <%= tape[:part_cache_max_size] %> mbytes
}

define dumptype encrypt-tar-local {
  auth "local"
  program "GNUTAR"
#  encrypt client
#  client_encrypt "/usr/sbin/amcryptsimple"
#  client-decrypt-option "none"
#  server-decrypt-option "-d"
}

holdingdisk hd {
  directory "<%= amanda_dir[:holding_dir] %>"
}

define dumptype encrypt-tar-remote {
  auth "ssh"
  ssh_keys "<%= amanda[:key_dir] %>/id_rsa"
  program "GNUTAR"
  # Add encryption later
}

